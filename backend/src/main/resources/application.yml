# compila.dev - Spring Boot Configuration

spring:
  application:
    name: compila-dev
  main:
    allow-circular-references: true
  docker:
    compose:
      enabled: false

  # Database
  datasource:
    url: ${DB_URL:jdbc:postgresql://192.168.1.110:5444/compiladev?ssl=false&serverTimezone=America/Sao_Paulo}
    username: ${DB_USER:admin}
    password: ${DB_PASSWORD:Rapidex@727204}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  # JPA
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        default_schema: public
    open-in-view: false

  # Redis
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

  # Flyway
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  # OAuth2
  security:
    oauth2:
      client:
        registration:
          github:
            client-id: ${OAUTH_GITHUB_CLIENT_ID}
            client-secret: ${OAUTH_GITHUB_CLIENT_SECRET}
            scope: read:user,user:email
            redirect-uri: ${OAUTH_REDIRECT_URI:http://localhost:3000}/auth/callback/github
          google:
            client-id: ${OAUTH_GOOGLE_CLIENT_ID}
            client-secret: ${OAUTH_GOOGLE_CLIENT_SECRET}
            scope: profile,email
            redirect-uri: ${OAUTH_REDIRECT_URI:http://localhost:3000}/auth/callback/google
        provider:
          github:
            user-name-attribute: login
            user-info-uri: https://api.github.com/user
            authorization-uri: https://github.com/login/oauth/authorize
            token-uri: https://github.com/login/oauth/access_token
          google:
            user-name-attribute: email
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token

# Server
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api/v1

# JWT
jwt:
  secret: ${JWT_SECRET:compila-dev-secret-key-must-be-at-least-512-bits-long-for-hs512-algorithm-to-work-properly}
  expiration: ${JWT_EXPIRATION:86400000} # 24 hours
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7 days

# CORS
cors:
  allowed-origins: ${CORS_ORIGINS:http://localhost:3000,https://compila.dev}
  allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
  allowed-headers: "*"
  allow-credentials: true

# AI Service
ai-service:
  base-url: ${AI_SERVICE_URL:http://localhost:8001}
  timeout: ${AI_SERVICE_TIMEOUT:30000}

# Logging
logging:
  level:
    dev.compila: ${LOG_LEVEL:DEBUG}
    org.springframework.security: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Management
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Application
app:
  name: compila.dev
  version: 1.0.0
  description: Plataforma de desafios de programação

  # Features flags
  features:
    registration-enabled: ${REGISTRATION_ENABLED:true}
    oauth-github-enabled: ${OAUTH_GITHUB_ENABLED:true}
    oauth-google-enabled: ${OAUTH_GOOGLE_ENABLED:true}
    rate-limiting-enabled: ${RATE_LIMITING_ENABLED:true}
